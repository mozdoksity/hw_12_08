# Домашнее задание к занятию «Резервное копирование баз данных» Барсуков Алексей

**Домашнее задание выполните в Google Docs или в md-файле в вашем репозитории GitHub.** 

Для оформления вашего решения в GitHub можете воспользоваться [шаблоном](https://github.com/netology-code/sys-pattern-homework).

Название файла должно содержать номер лекции и фамилию студента. Пример названия: «12.8. Резервное копирование баз данных — Александр Александров».

Перед тем как выслать ссылку, убедитесь, что её содержимое не является приватным, то есть открыто на просмотр всем, у кого есть ссылка. Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате учебной группы.

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Ответ:
### 1.1.  Полный ежедневный бэкап или полный еженедельный бэкап + инкрименентный\дифиринциальный, все зависит от скорости восстановления и места для хранения
### 1.2. Подойдет полный бэкап + дифиренциальный\инкрименентный, все зависит от частоты снятия этих бэкапов
### 1.3. Можно настроить реплику master-slave, где при выходе из строя мастера будет переключение на слейв в автоматическом или ручном режим.

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Ответ:
2.1
```
pg_dump -h "server" -p 5432 -U postgres --compress=0 --encoding='UTF8' --format=c "name_database" > /tmp/name_database.dump

pg_restore -h "server" -p 5432 -U postgres -d "name_database" /tmp/name_database.dump
```
2.1* C помощью скриптов написаные на bash или любом другом скриптовом языке можно организовать получения списка баз и создание бэкапов в нужную папку, далее данный скрипт можно добавить в cron и получаем автоматическое создание бэкапов

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Ответ:

3.1 
```
mysqldump --flush-logs --delete-master-logs --single-transaction --all-databases | gzip > /var/backups/mysql/$(date +%d-%m-%Y_%H-%M-%S)-inc.gz
```

---

Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.
